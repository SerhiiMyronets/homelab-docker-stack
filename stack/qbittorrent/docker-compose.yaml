services:
  vpn:
    image: qmcgaw/gluetun
    container_name: vpn
    cap_add:
      - NET_ADMIN
    ports:
      - "8080:8080"
      - "6881:6881"
      - "6881:6881/udp"
    volumes:
      - /mnt/data/docker/qbittorrent/gluetun:/gluetun
      - /mnt/data/secrets/nordvpn:/gluetun/creds:ro
    environment:
      - VPN_SERVICE_PROVIDER=nordvpn
      - VPN_TYPE=openvpn
      - OPENVPN_USER_FILE=/gluetun/creds/user
      - OPENVPN_PASSWORD_FILE=/gluetun/creds/pass
      - SERVER_COUNTRIES=Netherlands
    restart: unless-stopped
    networks:
      - torrents_edge

  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    network_mode: "service:vpn"
    depends_on:
      - vpn
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Los_Angeles
      - WEBUI_PORT=8080
    volumes:
      - /mnt/data/docker/qbittorrent/config:/config
      - /mnt/data/samba/torrents:/downloads
    restart: unless-stopped
    networks:
      - torrents_edge

networks:
  torrents_edge:
    external: true